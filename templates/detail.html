{#<!DOCTYPE html>#}
{#<html lang="en">#}
{#<head>#}
{#    <meta charset="UTF-8">#}
{#    <title>{{ name }}</title>#}
{#    <!-- import vue-->#}
{#    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>#}
{#    <!-- import Element UI style -->#}
{#    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-ui@2.15.6/lib/theme-chalk/index.css">#}
{#    <!-- import Element UI ui lib -->#}
{#    <script src="https://cdn.jsdelivr.net/npm/element-ui@2.15.6/lib/index.js"></script>#}
{#    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>#}
{#    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>#}
{#    <script src="//unpkg.com/vue@2"></script>#}
{#    <script src="//unpkg.com/element-ui"></script>#}
{#    <script src="//unpkg.com/element-ui/lib/umd/locale/en.js"></script>#}
{#</head>#}
{#<body>#}
{#detail page code : {{ insert_id }}#}
{#<br>#}
{#detail: {{ record }}#}
{#</body>#}
{#</html>#}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ name }}</title>
    <!-- import vue-->
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <!-- import Element UI style -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-ui@2.15.6/lib/theme-chalk/index.css">
    <!-- import Element UI ui lib -->
    <script src="https://cdn.jsdelivr.net/npm/element-ui@2.15.6/lib/index.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="//unpkg.com/vue@2"></script>
    <script src="//unpkg.com/element-ui"></script>
    <script src="//unpkg.com/element-ui/lib/umd/locale/en.js"></script>
    <!-- import Socket.IO -->
    <script src="https://cdn.jsdelivr.net/npm/socket.io/dist/socket.io.js"></script>
    <script src="{{ url_for('static', filename='js/commonUtils.js') }}"></script>
</head>
<body>

<div id="app">
    <el-card>
        <h2><strong>Title:</strong> {{ record.title }}</h2>
        <p><strong>Description:</strong> {{ record.description }}</p>
        <p><strong>Upload Time:</strong> {{ record.created_at }}</p>
        <el-table :data="data.file_urls" style="width: 100%">
            <el-table-column prop="filename" label="File Name"></el-table-column>
            <el-table-column label="Download">
                <template slot-scope="scope">
                    <el-button type="primary" @click="downloadFile(scope.row.file_urls)">Download</el-button>
                </template>
            </el-table-column>
        </el-table>
        <el-input v-model="sparqlQuery" type="textarea" placeholder="Enter SPARQL query" rows="6" style="margin-top: 20px;"></el-input>
        <el-button type="success" @click="">Send Query</el-button>
        <el-table :data="results" style="width: 100%; margin-top: 20px;">
            <el-table-column v-for="(value, key) in results[0]" :prop="key" :label="key" :key="key"></el-table-column>
        </el-table>

        <el-button type="danger" @click="confirmDelete">Delete</el-button>
        <el-dialog
            title="Confirm Delete"
            :visible.sync="dialogVisible"
            width="30%"
            @close="dialogVisible = false">
            <span>Are you sure you want to delete this record?</span>
            <span slot="footer" class="dialog-footer">
                <el-button @click="dialogVisible = false">Cancel</el-button>
                <el-button type="primary" @click="deleteRecord">Confirm</el-button>
            </span>
        </el-dialog>

    </el-card>
</div>

</body>

<script>
    new Vue({
        el: '#app',
        data: {
            data: {{ record | tojson }},
            record_id:{{ insert_id | tojson}},
            sparqlQuery: '',
            results: [],
            dialogVisible: false
        },
        mounted() {
            console.log(this.record_id)
            console.log(this.data)

            setCurrentURL("/detail/"+this.record_id)

/*
            this.socket = io();
            this.socket.on('connect', () => {
                this.socket.emit('join', { username: 'user', room: this.data._id });
            });
            this.socket.on('sparql_result', (data) => {
                if (data.results) {
                    this.results = data.results;
                } else if (data.error) {
                    this.$message.error(data.error);
                }
            });
*/
        },
        methods: {
            downloadFile(file) {
                window.location.href = `/download/${file}`;
            },

/*
            sendQuery() {
                if (this.sparqlQuery.trim() === '') {
                    this.$message.error('SPARQL query is required');
                    return;
                }
                this.socket.emit('sparql_query', { username: 'user', room: this.data._id, query: this.sparqlQuery });
            }
*/
            confirmDelete() {
                this.dialogVisible = true;
            },
            deleteRecord() {
                axios.get(`/deleteRDF_request/${this.record_id}`)
                    .then(response => {
                        this.$message.success('Record deleted successfully');
                        window.location.href = '/uploadHistory';
                    })
                    .catch(error => {
                        this.$message.error('Error deleting record');
                    });
                this.dialogVisible = false;
            }
        }
    });
    ELEMENT.locale(ELEMENT.lang.en);
</script>
</html>
